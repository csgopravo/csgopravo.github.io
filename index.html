<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tool D·ª± ƒêo√°n T√†i/X·ªâu</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    #game-frame {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      z-index: 0;
    }

    #tool-box {
      position: fixed;
      top: 40px;
      left: 40px;
      width: 280px;
      background: rgba(0, 0, 0, 0.85);
      color: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 10;
    }

    #tool-box h3 {
      margin-top: 0;
      font-size: 20px;
      text-align: center;
    }

    input {
      padding: 8px;
      font-size: 14px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      padding: 8px;
      font-size: 14px;
      border: none;
      background: green;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    #result, #historyBox {
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<iframe id="game-frame" src="https://68gbvn25.space/?code=14485667"></iframe>

<div id="tool-box">
  <h3>üîß Tool D·ª± ƒêo√°n</h3>

  <div style="display: flex; gap: 6px;">
    <input type="text" id="md5" placeholder="Nh·∫≠p m√£ MD5" />
    <button onclick="duDoan()">D·ª± ƒêo√°n</button>
  </div>

  <div style="display: flex; gap: 6px; margin-top: 8px;">
    <input type="text" id="actual" placeholder="K·∫øt qu·∫£ T/X" disabled />
    <button onclick="xacNhanKetQua()">X√°c Nh·∫≠n</button>
  </div>

  <div id="result"></div>
  <div id="historyBox"></div>
</div>

<script>
  const KEY = "o8S;HJUkcfI17h[#tG1k^rajzd;D>[cGtw#Co";
  let history = [];
  let winCount = 0, loseCount = 0;
  let lastHex = "", lastPrediction = "";

  function md5_to_hex(md5_string) {
    return CryptoJS.MD5(md5_string + KEY).toString();
  }

  function analyze_hex(hex) {
    let total = 0;
    for (let ch of hex) {
      total += parseInt(ch, 16);
    }

    const sumLastBytes = [...Array(4)].map((_, i) =>
      parseInt(hex.slice(hex.length - 8 + i * 2, hex.length - 6 + i * 2), 16)
    ).reduce((a, b) => a + b, 0);

    let streak_bonus = 0;
    if (history.length >= 2 && history[history.length - 1] === history[history.length - 2]) {
      streak_bonus = history[history.length - 1] === "T" ? 8 : -8;
    }

    let tai_percent = 50 + (((total % 18) - 9) * 2) + ((sumLastBytes % 10) - 5) + streak_bonus;
    tai_percent = Math.max(30, Math.min(70, tai_percent));
    const xiu_percent = 100 - tai_percent;
    const prediction = tai_percent > xiu_percent ? "T" : "X";

    return { tai_percent, xiu_percent, prediction };
  }

  function duDoan() {
    const md5 = document.getElementById("md5").value.trim().toLowerCase();
    if (!/^[0-9a-f]{32}$/.test(md5)) {
      alert("M√£ MD5 kh√¥ng h·ª£p l·ªá!");
      return;
    }

    lastHex = md5_to_hex(md5);
    const { tai_percent, xiu_percent, prediction } = analyze_hex(lastHex);
    lastPrediction = prediction;

    document.getElementById("result").innerHTML = `
      <p>üéØ T·ª∑ l·ªá T√†i: <b>${tai_percent.toFixed(2)}%</b> | X·ªâu: <b>${xiu_percent.toFixed(2)}%</b></p>
      <p>üí° D·ª± ƒëo√°n: <b style="color: ${prediction === 'T' ? 'red' : 'aqua'};">${prediction === 'T' ? 'T√†i' : 'X·ªâu'}</b></p>
    `;
    document.getElementById("actual").disabled = false;
    document.getElementById("actual").focus();
  }

  function xacNhanKetQua() {
    const actual = document.getElementById("actual").value.trim().toUpperCase();
    if (!["T", "X"].includes(actual)) {
      alert("Vui l√≤ng nh·∫≠p k·∫øt qu·∫£ l√† 'T' ho·∫∑c 'X'");
      return;
    }
    if (!lastPrediction) {
      alert("B·∫°n c·∫ßn d·ª± ƒëo√°n tr∆∞·ªõc!");
      return;
    }

    history.push(actual);
    if (actual === lastPrediction) {
      document.getElementById("result").innerHTML += `<p style="color:lime;">‚úÖ D·ª± ƒëo√°n ƒë√∫ng!</p>`;
      winCount++;
    } else {
      document.getElementById("result").innerHTML += `<p style="color:orange;">‚ùå Sai r·ªìi!</p>`;
      loseCount++;
    }

    const total = winCount + loseCount;
    const rate = ((winCount / total) * 100).toFixed(2);

    document.getElementById("historyBox").innerHTML = `
      <p>üìä T·ªïng: ${total} | ‚úÖ Th·∫Øng: ${winCount} | ‚ùå Thua: ${loseCount} | üéØ T·ª∑ l·ªá ƒë√∫ng: ${rate}%</p>
    `;

    // Reset
    document.getElementById("md5").value = "";
    document.getElementById("actual").value = "";
    document.getElementById("actual").disabled = true;
    lastPrediction = "";
  }

  // Cho ph√©p k√©o h·ªôp tool
  const box = document.getElementById("tool-box");
  let isDragging = false, offsetX, offsetY;

  box.addEventListener("mousedown", function (e) {
    isDragging = true;
    offsetX = e.clientX - box.offsetLeft;
    offsetY = e.clientY - box.offsetTop;
  });

  document.addEventListener("mouseup", function () {
    isDragging = false;
  });

  document.addEventListener("mousemove", function (e) {
    if (isDragging) {
      box.style.left = (e.clientX - offsetX) + "px";
      box.style.top = (e.clientY - offsetY) + "px";
    }
  });
</script>

<!-- Th√™m th∆∞ vi·ªán CryptoJS ƒë·ªÉ hash MD5 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

</body>
</html>
